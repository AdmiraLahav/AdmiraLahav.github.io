<!DOCTYPE html>
<html>
<head>
  <title>Blog - Admiral Lahav</title>

  <!-- Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-Y3KF9ZZ8JP"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-Y3KF9ZZ8JP');
  </script>

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    .nav-link { margin-right: 15px; }
  </style>
</head>
<body class="container py-4">

  <!-- Navbar -->
  <nav class="mb-4">
    <a href="index.html" class="nav-link d-inline">Home</a>
    <a href="blog.html" class="nav-link d-inline fw-bold">Blog</a>
  </nav>

  <h1 class="mb-4">üìö Blog</h1>

  <!-- Post Form -->
  <h3>Create a New Post</h3>
  <form id="postForm" class="mb-4">
    <input type="text" id="postTitle" placeholder="Post Title" class="form-control mb-2" required>
    <textarea id="postContent" placeholder="Post Content" class="form-control mb-2" rows="4" required></textarea>
    <button type="submit" class="btn btn-success">Post</button>
  </form>

  <button onclick="clearAllPosts()" class="btn btn-warning mb-3">Clear All Posts</button>

  <hr>
  <h3>Posts:</h3>
  <div id="postsContainer"></div>

  <!-- Scripts -->
  <script>
    function loadPosts() {
  fetch('data/posts.json')
    .then(res => res.json())
    .then(posts => {
      const container = document.getElementById('postsContainer');
      container.innerHTML = '';

      if (!posts.length) {
        container.innerHTML = `<p class="text-muted">No posts found.</p>`;
        return;
      }

      posts.forEach(post => {
        container.innerHTML += `
          <div class="card mb-3">
            <div class="card-body">
              <h5 class="card-title">${post.title}</h5>
              <p class="card-text">${post.content}</p>
            </div>
          </div>
        `;
      });
    })
    .catch(err => {
      console.error('Failed to load posts:', err);
      document.getElementById('postsContainer').innerHTML =
        `<p class="text-danger">Failed to load posts. Are you offline or missing the JSON file?</p>`;
    });
}


    document.getElementById('postForm').addEventListener('submit', function (e) {
  e.preventDefault();
  const title = document.getElementById('postTitle').value;
  const content = document.getElementById('postContent').value;

  writePostToGitHub({ title, content });
  document.getElementById('postForm').reset();
});


    function deletePost(index) {
      const posts = JSON.parse(localStorage.getItem('posts') || '[]');
      posts.splice(index, 1);
      localStorage.setItem('posts', JSON.stringify(posts));
      loadPosts();
    }

    function clearAllPosts() {
      if (confirm("Are you sure you want to delete all posts?")) {
        localStorage.removeItem('posts');
        loadPosts();
      }
    }

    loadPosts();
const GITHUB_USERNAME = 'admiralahav';
const GITHUB_REPO = 'admiralahav.github.io';
const FILE_PATH = 'data/posts.json';

// üî• TEMP for dev only ‚Äî remove before public deploy!
const GITHUB_TOKEN = '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';

function writePostToGitHub(newPost) {
  fetch(`https://api.github.com/repos/${GITHUB_USERNAME}/${GITHUB_REPO}/contents/${FILE_PATH}`, {
    headers: {
      Authorization: `token ${GITHUB_TOKEN}`
    }
  })
  .then(res => res.json())
  .then(fileData => {
    const existingContent = JSON.parse(atob(fileData.content));
    existingContent.unshift(newPost);

    const updatedContent = btoa(JSON.stringify(existingContent, null, 2));

    return fetch(`https://api.github.com/repos/${GITHUB_USERNAME}/${GITHUB_REPO}/contents/${FILE_PATH}`, {
      method: 'PUT',
      headers: {
        'Authorization': `token ${GITHUB_TOKEN}`,
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        message: `Add new post: ${newPost.title}`,
        content: updatedContent,
        sha: fileData.sha
      })
    });
  })
  .then(res => res.json())
  .then(data => {
    alert("‚úÖ Post saved to GitHub!");
    loadPosts(); // reload after update
  })
  .catch(err => {
    console.error("‚ùå GitHub save error:", err);
    alert("Error saving post. See console.");
  });
}

    
  </script>
</body>
</html>
